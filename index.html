<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vinted Feed ‚Äî VIP Demo</title>
<style>
:root {
  --bg:#f5f7fb; --card:#fff; --text:#0b1220; --muted:#6b7280; --accent:#2563eb;
  --vip-aura: 0 0 18px rgba(255,60,0,0.35);
}
*{box-sizing:border-box;}
html, body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);}
.dark{--bg:#071023;--card:#0d1722;--text:#e6eef8;--muted:#9aa6bf;}
header{position:fixed;top:0;left:0;right:0;height:64px;display:flex;align-items:center;justify-content:flex-end;padding:0 16px;background:rgba(255,255,255,0.9);backdrop-filter:blur(6px);z-index:60;}
.dark header{background:rgba(10,12,18,0.85);}
#settingsBtn{width:40px;height:40px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center}
#settingsBtn.vip{box-shadow:var(--vip-aura);}
#settingsBtn img{width:100%;height:100%;object-fit:contain}

/* Settings panel */
#settingsPanel{position:fixed;top:76px;right:12px;width:320px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 18px 40px rgba(2,6,23,0.12);display:none;z-index:70}
.field{margin:8px 0;font-size:0.95rem}
.field label{display:flex;align-items:center;gap:8px}
.small{font-size:0.86rem;color:var(--muted)}
.vip-status{display:flex;align-items:center;gap:8px;justify-content:space-between}

/* Main/card */
main{padding-top:86px;width:92%;max-width:920px;margin:0 auto;min-height:calc(100vh - 140px);display:flex;flex-direction:column;align-items:center;gap:12px;}
.card{width:100%;background:var(--card);border-radius:12px;box-shadow:0 18px 40px rgba(2,6,23,0.06);overflow:hidden;display:flex;flex-direction:column;transition:transform .4s ease;}
.card img{width:100%;height:320px;object-fit:cover;background:#f3f3f3;border-radius:12px;}
.info{padding:14px;display:flex;flex-direction:column;gap:6px;}
.info h2{margin:0;font-size:1.15rem;}
.info p{margin:0;color:var(--muted);}
.price{font-weight:800;color:var(--accent);margin-top:8px;}

/* desktop layout */
@media(min-width:820px){
  .card{flex-direction:row;height:460px;}
  .card img{width:62%;height:100%;}
  .info{width:38%;padding:22px;justify-content:center;}
}

/* Bottom controls */
.controls{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;display:flex;gap:10px;z-index:60}
.btn{padding:10px 16px;border-radius:10px;border:0;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;box-shadow:0 10px 24px rgba(37,99,235,0.12)}
.btn.ghost{background:#6b7280}
.btn.fav{background:#e7463a}
.btn.small{padding:6px 12px;font-size:0.88rem}

/* Popup base */
.popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:520px;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 24px 80px rgba(2,6,23,0.18);display:none;z-index:120;max-height:82vh;overflow:auto}
.popup .close{position:absolute;right:12px;top:10px;cursor:pointer;font-weight:700;font-size:18px}
.item-list>div{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px solid rgba(0,0,0,0.06)}
.item-list img{width:64px;height:64px;object-fit:cover;border-radius:8px}
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.chip{padding:6px 8px;border-radius:8px;border:1px solid #ddd;cursor:pointer;font-size:0.92rem}
.chip.on{background:gold;color:#000;border-color:gold}

/* Best article notification */
#bestNotif{position:fixed;top:12px;left:12px;background:var(--accent);color:#fff;padding:8px 14px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.15);display:none;z-index:130;font-weight:600;font-size:0.92rem;}

/* small helpers */
.hidden{display:none}
.small-muted{color:var(--muted);font-size:0.9rem}
</style>
</head>
<body>

<header>
  <div id="settingsBtn" title="Param√®tres (Vinted)"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Vinted_logo.svg/256px-Vinted_logo.svg.png" alt="Param"></div>
</header>

<div id="bestNotif">‚≠ê Nouveau meilleur article !</div>

<!-- Settings panel -->
<div id="settingsPanel" role="dialog" aria-hidden="true">
  <div class="field vip-status">
    <div><strong>‚öôÔ∏è Param√®tres</strong></div>
    <div id="vipIndicator" class="small-muted">Non VIP</div>
  </div>

  <div class="field"><label><input id="darkToggle" type="checkbox"> Mode sombre / clair</label></div>

  <div class="field small-muted">Compte</div>
  <div class="field">
    <button id="openVipBtn" class="btn ghost">Devenir VIP</button>
  </div>

  <hr/>

  <div class="field small-muted">Fonctionnalit√©s VIP</div>
  <div id="vipControlsArea" class="hidden">
    <div class="field"><label><input id="toggle0Delay" type="checkbox"> 0 Delay (rapide)</label></div>
    <div class="field"><label><input id="toggleNotifBest" type="checkbox"> Notifications meilleurs articles</label></div>
    <div class="field"><label><input id="toggleFavs" type="checkbox"> Activer Favoris</label></div>
    <div class="field"><button id="openBrandsBtn" class="btn ghost">Marques pr√©f√©r√©es</button></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="openFavoritesBtn" class="btn">Voir favoris</button>
      <button id="openHistoryBtn" class="btn ghost">Voir historique</button>
    </div>
  </div>

  <div style="margin-top:10px" class="small-muted">Les notifications et "Meilleurs articles" sont factices (simulation).</div>
</div>

<main>
  <div class="card" id="card">
    <img id="itemImg" src="" alt="Article image">
    <div class="info">
      <h2 id="itemTitle">Titre de l'article</h2>
      <p id="itemBrand" class="small-muted">Marque</p>
      <p id="itemSize" class="small-muted">Taille</p>
      <p id="itemCond" class="small-muted">√âtat</p>
      <div class="price" id="itemPrice">0‚Ç¨</div>
    </div>
  </div>
</main>

<div class="controls" role="toolbar" aria-label="Actions">
  <button id="skipBtn" class="btn ghost">‚è≠ Skip</button>
  <button id="favBtn" class="btn fav hidden">‚ù§Ô∏è Favoris</button>
  <button id="viewBtn" class="btn">üõç Voir sur Vinted</button>
</div>

<!-- Popups: VIP, Brands, Favorites, History, Best -->
<div id="vipPopup" class="popup">
  <span class="close" id="vipClose">‚úñ</span>
  <h3>Devenir VIP ‚Äî 4,99‚Ç¨ / mois (simulation)</h3>
  <p class="small-muted">Test : dur√©e VIP = 60s. Apr√®s expiration, les fonctionnalit√©s disparaissent.</p>
  <ul>
    <li>0 Delay (rafra√Æchissement plus rapide)</li>
    <li>Notifications meilleurs articles</li>
    <li>Favoris sur les articles</li>
    <li>Historique des skips</li>
    <li>Marques pr√©f√©r√©es (filtre)</li>
  </ul>
  <div style="margin-top:12px;display:flex;gap:8px">
    <button id="payVip" class="btn">Payer 4,99‚Ç¨ (simul√©)</button>
    <button id="cancelVip" class="btn ghost">Annuler</button>
  </div>
</div>

<div id="brandsPopup" class="popup">
  <span class="close" id="brandsClose">‚úñ</span>
  <h3>Marques pr√©f√©r√©es (VIP)</h3>
  <div id="brandsChips" class="chips" style="margin-top:10px"></div>
  <div style="margin-top:12px"><button id="closeBrands" class="btn ghost">Fermer</button></div>
</div>

<div id="favoritesPopup" class="popup">
  <span class="close" id="favClose">‚úñ</span>
  <h3>Favoris</h3>
  <div id="favoritesList" class="item-list"></div>
  <div style="margin-top:10px"><button id="clearFavs" class="btn ghost">Tout supprimer</button></div>
</div>

<div id="historyPopup" class="popup">
  <span class="close" id="histClose">‚úñ</span>
  <h3>Historique</h3>
  <div id="historyList" class="item-list"></div>
  <div style="margin-top:10px"><button id="clearHistory" class="btn ghost">Tout supprimer</button></div>
</div>

<script>
/* -------------------------
   State + sample data
------------------------- */
const BRANDS = ["Nike","Adidas","Ralph Lauren","CP Company","Puma","Reebok","New Balance","Converse","Vans","The North Face","Columbia","Patagonia","Fila","Champion","Tommy Hilfiger","Lacoste","Jordan","Asics","Carhartt","Supreme"];
let items = [
  {id:1,title:"Sweat Nike Tech",brand:"Nike",size:"M",cond:"Tr√®s bon √©tat",price:"45‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1520975698519-53c8e7c1a7a6?w=800"},
  {id:2,title:"T-shirt Dior logo",brand:"Dior",size:"L",cond:"Neuf",price:"90‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=800"},
  {id:3,title:"Jean Levi's 501",brand:"Levi's",size:"42",cond:"Bon √©tat",price:"55‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1589654314857-acc0c3c5e5a4?w=800"},
  {id:4,title:"Veste Zara beige",brand:"Zara",size:"S",cond:"Tr√®s bon √©tat",price:"35‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1539695393000-3f8a0d8fde23?w=800"}
];
let idx=0, isVIP=false, vipExpires=0, vipInterval=null, favorites=[], history=[], bestArticles=[], selectedBrands=[], zeroDelay=false, notifBest=false, feedInterval=null;

/* -------------------------
   DOM refs
------------------------- */
const settingsBtn=document.getElementById('settingsBtn');
const settingsPanel=document.getElementById('settingsPanel');
const darkToggle=document.getElementById('darkToggle');
const vipIndicator=document.getElementById('vipIndicator');
const vipControlsArea=document.getElementById('vipControlsArea');
const openVipBtn=document.getElementById('openVipBtn');
const vipPopup=document.getElementById('vipPopup');
const vipClose=document.getElementById('vipClose');
const payVip=document.getElementById('payVip');
const cancelVip=document.getElementById('cancelVip');

const itemImg=document.getElementById('itemImg');
const itemTitle=document.getElementById('itemTitle');
const itemBrand=document.getElementById('itemBrand');
const itemSize=document.getElementById('itemSize');
const itemCond=document.getElementById('itemCond');
const itemPrice=document.getElementById('itemPrice');

const skipBtn=document.getElementById('skipBtn');
const favBtn=document.getElementById('favBtn');
const viewBtn=document.getElementById('viewBtn');

const toggle0Delay=document.getElementById('toggle0Delay');
const toggleNotifBest=document.getElementById('toggleNotifBest');
const toggleFavs=document.getElementById('toggleFavs');
const openBrandsBtn=document.getElementById('openBrandsBtn');
const brandsChips=document.getElementById('brandsChips');

const brandsPopup=document.getElementById('brandsPopup');
const brandsClose=document.getElementById('brandsClose');
const closeBrands=document.getElementById('closeBrands');

const favoritesPopup=document.getElementById('favoritesPopup');
const favoritesList=document.getElementById('favoritesList');
const favClose=document.getElementById('favClose');
const clearFavs=document.getElementById('clearFavs');

const historyPopup=document.getElementById('historyPopup');
const historyList=document.getElementById('historyList');
const histClose=document.getElementById('histClose');
const clearHistory=document.getElementById('clearHistory');

const bestNotif=document.getElementById('bestNotif');

const openFavoritesBtn=document.getElementById('openFavoritesBtn');
const openHistoryBtn=document.getElementById('openHistoryBtn');

/* -------------------------
   Utility
------------------------- */
function openPopup(el){ el.style.display='block'; }
function closePopup(el){ el.style.display='none'; }
function applyTheme(){ document.documentElement.classList.toggle('dark', darkToggle.checked); }

/* -------------------------
   Render feed
------------------------- */
function findNextIndex(start){
  if(isVIP && selectedBrands.length>0){
    for(let i=0;i<items.length;i++){
      const j=(start+i)%items.length;
      if(selectedBrands.includes(items[j].brand)) return j;
    }
    return start;
  }
  return start;
}
function renderCurrent(){
  if(items.length===0){ itemImg.src=''; itemTitle.textContent='Aucun article'; itemBrand.textContent=''; itemSize.textContent=''; itemCond.textContent=''; itemPrice.textContent=''; return;}
  idx=findNextIndex(idx);
  const it=items[idx];
  itemImg.src=it.image||'';
  itemTitle.textContent=it.title||'';
  itemBrand.textContent='Marque : '+(it.brand||'');
  itemSize.textContent='Taille : '+(it.size||'');
  itemCond.textContent='√âtat : '+(it.cond||'');
  itemPrice.textContent=it.price||'';
  viewBtn.onclick=()=>window.open(it.link||'#','_blank');
  favBtn.classList.toggle('hidden',!(isVIP && toggleFavs.checked));
}

/* -------------------------
   Skip
------------------------- */
function doSkip(){
  const card=document.querySelector('.card');
  card.style.transition='transform .36s ease, opacity .3s';
  card.style.transform='translateX(-120%)';
  card.style.opacity='0';
  setTimeout(()=>{
    history.unshift(items[idx]);
    idx=(idx+1)%items.length;
    card.style.transition='none';
    card.style.transform='translateX(0)';
    card.style.opacity='1';
    renderCurrent();
    if(isVIP && toggleNotifBest.checked && Math.random()<0.35){
      bestArticles.unshift(items[idx]);
      if(bestArticles.length>6) bestArticles.length=6;
      bestNotif.style.display='block';
      setTimeout(()=>bestNotif.style.display='none',2000);
    }
  },360);
}

/* -------------------------
   Favorites
------------------------- */
function addToFavorites(){
  const it=items[idx];
  if(!favorites.find(f=>f.id===it.id)) favorites.unshift(it);
  favBtn.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:180});
}
function renderFavoritesList(){
  favoritesList.innerHTML='';
  if(favorites.length===0){ favoritesList.innerHTML='<div class="small">Aucun favori</div>'; return;}
  favorites.forEach((it,i)=>{
    const row=document.createElement('div');
    row.innerHTML=`<img src="${it.image}" alt=""><div><strong>${it.title}</strong><div class="small-muted">${it.price}</div><div style="margin-top:8px"><button data-i="${
