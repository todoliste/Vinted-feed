<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Vinted Feed - Stable</title>
<style>
  :root{--bg:#f6f8fb;--card:#fff;--text:#0b1220;--muted:#6b7280;--accent:#2563eb}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{position:fixed;right:0;left:0;top:0;height:64px;display:flex;justify-content:flex-end;align-items:center;padding:0 12px;background:rgba(255,255,255,0.9);z-index:80}
  #settingsBtn{width:44px;height:44px;border-radius:10px;border:0;background:transparent;cursor:pointer}
  #settingsBtn img{width:100%;height:100%;object-fit:contain}
  #settingsPanel{position:fixed;top:74px;right:12px;width:320px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 12px 32px rgba(0,0,0,0.12);display:none;z-index:90}
  .field{margin:8px 0;font-size:0.95rem}
  .small{font-size:0.85rem;color:var(--muted)}
  main{padding-top:86px;width:94%;max-width:920px;margin:0 auto;min-height:calc(100vh - 160px);display:flex;align-items:center;justify-content:center}
  .card{width:100%;max-width:880px;background:var(--card);border-radius:12px;box-shadow:0 12px 32px rgba(0,0,0,0.06);overflow:hidden;display:flex;flex-direction:column}
  .card img{width:100%;height:320px;object-fit:cover;background:#f3f3f3}
  .info{padding:14px}
  .info h2{margin:0;font-size:1.2rem}
  .info p{margin:4px 0;color:var(--muted)}
  .price{font-weight:800;color:var(--accent);margin-top:8px}
  .controls{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;display:flex;gap:8px;z-index:80}
  .btn{padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer;background:var(--accent);color:#fff}
  .btn.ghost{background:#6b7280}
  .btn.fav{background:#e7463a}
  .popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:520px;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.18);display:none;z-index:120;max-height:80vh;overflow:auto}
  .popup .close{position:absolute;right:12px;top:10px;cursor:pointer;font-weight:700}
  .mini{position:fixed;right:16px;bottom:86px;width:300px;background:var(--card);padding:10px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.15);display:none;z-index:110}
  .mini .item{display:flex;gap:8px;align-items:center;padding:6px 0;border-bottom:1px solid rgba(0,0,0,0.06)}
  .chip{display:inline-block;padding:6px 8px;margin:6px;border-radius:8px;border:1px solid #ddd;cursor:pointer}
  .chip.on{background:gold;color:#000;border-color:gold}
  .hidden{display:none}
  @media(min-width:820px){ .card{flex-direction:row;height:420px} .card img{width:62%;height:100%} .info{width:38%;padding:20px} }
</style>
</head>
<body>

<header>
  <!-- top-right settings button (replace src later by your logo) -->
  <button id="settingsBtn" title="Param√®tres"><img id="settingsImg" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Vinted_logo.svg/256px-Vinted_logo.svg.png" alt="logo"></button>
</header>

<!-- Settings panel -->
<div id="settingsPanel" role="dialog" aria-hidden="true">
  <div class="field"><strong>‚öô Param√®tres</strong></div>
  <div class="field"><label><input id="darkToggle" type="checkbox"> Mode sombre / clair</label></div>
  <div class="field small">Compte</div>
  <div class="field"><button id="openVip" class="btn ghost">Devenir VIP</button></div>
  <hr/>
  <div class="field small">Fonctionnalit√©s VIP</div>
  <div id="vipArea" class="hidden">
    <div class="field"><label><input id="opt0delay" type="checkbox"> 0 Delay</label></div>
    <div class="field"><label><input id="optNotif" type="checkbox"> Notifications meilleurs articles</label></div>
    <div class="field"><label><input id="optFavs" type="checkbox"> Activer Favoris</label></div>
    <div class="field"><button id="openBrands" class="btn ghost">Marques pr√©f√©r√©es</button></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="openFavs" class="btn">Voir favoris</button>
      <button id="openHist" class="btn ghost">Voir historique</button>
    </div>
  </div>
  <div class="field small">Photos libres de droit (Unsplash). Prix factices.</div>
</div>

<main>
  <div class="card" id="card">
    <img id="img" src="https://images.unsplash.com/photo-1520975698519-53c8e7c1a7a6?q=80&w=1200&auto=format&fit=crop" alt="article">
    <div class="info">
      <h2 id="title">Sweat Nike Tech</h2>
      <p id="brand" class="small">Marque : Nike</p>
      <p id="size" class="small">Taille : M</p>
      <p id="cond" class="small">√âtat : Tr√®s bon</p>
      <div class="price" id="price">45‚Ç¨</div>
    </div>
  </div>
</main>

<!-- controls -->
<div class="controls">
  <button id="skip" class="btn ghost">‚è≠ Skip</button>
  <button id="fav" class="btn fav hidden">‚ù§Ô∏è Favoris</button>
  <button id="view" class="btn">üõç Voir sur Vinted</button>
</div>

<!-- mini best -->
<div id="mini" class="mini">
  <strong>Meilleurs articles</strong>
  <div id="miniList"></div>
  <div style="text-align:right;margin-top:8px"><button id="closeMini" class="btn ghost">Fermer</button></div>
</div>

<!-- popups -->
<div id="vipPopup" class="popup"><span class="close" id="vipClose">‚úñ</span>
  <h3>Devenir VIP ‚Äî 4,99‚Ç¨ (simulation)</h3>
  <p class="small">Test VIP = 60s. Apr√®s expiration, options retir√©es.</p>
  <ul><li>0 Delay</li><li>Notifications meilleurs articles</li><li>Favoris</li><li>Historique</li><li>Marques pr√©f√©r√©es</li></ul>
  <div style="display:flex;gap:8px;margin-top:10px"><button id="payVip" class="btn">Payer (simul√©)</button><button id="cancelVip" class="btn ghost">Annuler</button></div>
</div>

<div id="brandsPopup" class="popup"><span class="close" id="brandsClose">‚úñ</span>
  <h3>Marques pr√©f√©r√©es</h3>
  <div id="brandsArea" style="margin-top:10px"></div>
  <div style="margin-top:12px"><button id="closeBrandsBtn" class="btn ghost">Fermer</button></div>
</div>

<div id="favPopup" class="popup"><span class="close" id="favClose">‚úñ</span>
  <h3>Favoris</h3><div id="favList" class="item-list"></div>
  <div style="margin-top:10px"><button id="clearFav" class="btn ghost">Tout supprimer</button></div>
</div>

<div id="histPopup" class="popup"><span class="close" id="histClose">‚úñ</span>
  <h3>Historique</h3><div id="histList" class="item-list"></div>
  <div style="margin-top:10px"><button id="clearHist" class="btn ghost">Tout supprimer</button></div>
</div>

<script>
/* ===== minimal, reliable state ===== */
const BRANDS = ["Nike","Adidas","Ralph Lauren","CP Company","Puma","Reebok","New Balance","Converse","Vans","The North Face","Columbia","Patagonia","Fila","Champion","Tommy Hilfiger","Lacoste","Jordan","Asics","Carhartt","Supreme"];

let items = [
  {id:1,title:"Sweat Nike Tech",brand:"Nike",size:"M",cond:"Tr√®s bon √©tat",price:"45‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1520975698519-53c8e7c1a7a6?q=80&w=1200&auto=format&fit=crop"},
  {id:2,title:"T-shirt Dior logo",brand:"Dior",size:"L",cond:"Neuf",price:"90‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?q=80&w=1200&auto=format&fit=crop"},
  {id:3,title:"Jean Levi's 501",brand:"Levi's",size:"42",cond:"Bon √©tat",price:"55‚Ç¨",link:"#",image:"https://images.unsplash.com/photo-1589654314857-acc0c3c5e5a4?q=80&w=1200&auto=format&fit=crop"}
];

let idx = 0, isVIP=false, vipExpires = 0, vipTimer=null;
let favorites = [], history = [], bestArticles = [], selectedBrands = [];
let feedTimer = null, bestTimer = null;

/* ===== refs ===== */
const settingsBtn = document.getElementById('settingsBtn');
const settingsPanel = document.getElementById('settingsPanel');
const darkToggle = document.getElementById('darkToggle');
const vipArea = document.getElementById('vipArea');
const openVip = document.getElementById('openVip');

const imgEl = document.getElementById('img');
const titleEl = document.getElementById('title');
const brandEl = document.getElementById('brand');
const sizeEl = document.getElementById('size');
const condEl = document.getElementById('cond');
const priceEl = document.getElementById('price');

const skipBtn = document.getElementById('skip');
const favBtn = document.getElementById('fav');
const viewBtn = document.getElementById('view');

const vipPopup = document.getElementById('vipPopup');
const vipClose = document.getElementById('vipClose');
const payVip = document.getElementById('payVip');
const cancelVip = document.getElementById('cancelVip');

const mini = document.getElementById('mini');
const miniList = document.getElementById('miniList');
const closeMini = document.getElementById('closeMini');

const brandsPopup = document.getElementById('brandsPopup');
const brandsArea = document.getElementById('brandsArea');
const openBrands = document.getElementById('openBrands');
const brandsClose = document.getElementById('brandsClose');
const closeBrandsBtn = document.getElementById('closeBrandsBtn');

const favPopup = document.getElementById('favPopup');
const favList = document.getElementById('favList');
const favClose = document.getElementById('favClose');
const clearFav = document.getElementById('clearFav');

const histPopup = document.getElementById('histPopup');
const histList = document.getElementById('histList');
const histClose = document.getElementById('histClose');
const clearHist = document.getElementById('clearHist');

const opt0 = document.getElementById('opt0delay');
const optNotif = document.getElementById('optNotif');
const optFavs = document.getElementById('optFavs');

const openFavsBtn = document.getElementById('openFavs');
const openHistBtn = document.getElementById('openHist');

/* ===== helpers ===== */
function open(el){ el.style.display='block'; }
function close(el){ el.style.display='none'; }
function applyTheme(){ document.documentElement.classList.toggle('dark', darkToggle.checked); }

/* ===== render item with optional brand filter ===== */
function findNext(start){
  if(isVIP && selectedBrands.length>0){
    for(let i=0;i<items.length;i++){
      const j=(start+i)%items.length;
      if(selectedBrands.includes(items[j].brand)) return j;
    }
  }
  return start;
}
function render(){
  if(items.length===0){ titleEl.textContent='Aucun article'; imgEl.src=''; return; }
  idx = findNext(idx);
  const it = items[idx];
  imgEl.src = it.image;
  titleEl.textContent = it.title;
  brandEl.textContent = 'Marque : ' + it.brand;
  sizeEl.textContent = 'Taille : ' + it.size;
  condEl.textContent = '√âtat : ' + it.cond;
  priceEl.textContent = it.price;
  viewBtn.onclick = ()=> window.open(it.link || '#','_blank');
  favBtn.classList.toggle('hidden', !(isVIP && optFavs.checked));
}

/* ===== skip (anim + history) ===== */
function doSkip(){
  const card = document.querySelector('.card');
  card.style.transition='transform .34s ease, opacity .3s';
  card.style.transform='translateX(-120%)';
  card.style.opacity='0';
  setTimeout(()=>{
    history.unshift(items[idx]); // add history
    idx = (idx+1)%items.length;
    card.style.transition='none';
    card.style.transform='translateX(0)';
    card.style.opacity='1';
    render();
  },340);
}

/* ===== favorites ===== */
function addFav(){ const it=items[idx]; if(!favorites.find(f=>f.id===it.id)) favorites.unshift(it); renderFavList(); }
function renderFavList(){
  favList.innerHTML='';
  if(favorites.length===0){ favList.innerHTML='<div class="small">Aucun favori</div>'; return; }
  favorites.forEach((it,i)=>{
    const row = document.createElement('div');
    row.className='item';
    row.innerHTML = `<img src="${it.image}" alt=""><div style="flex:1"><strong>${it.title}</strong><div class="small">${it.price}</div><div style="margin-top:6px"><button data-i="${i}" class="delFav">Suppr</button></div></div>`;
    favList.appendChild(row);
  });
  favList.querySelectorAll('.delFav').forEach(b=>b.onclick=()=>{ favorites.splice(Number(b.dataset.i),1); renderFavList(); });
}

/* ===== history ===== */
function renderHist(){
  histList.innerHTML='';
  if(history.length===0){ histList.innerHTML='<div class="small">Aucun historique</div>'; return; }
  history.forEach((it,i)=>{
    const row=document.createElement('div');
    row.className='item';
    row.innerHTML = `<img src="${it.image}" alt=""><div style="flex:1"><strong>${it.title}</strong><div class="small">${it.price}</div><div style="margin-top:6px"><button data-i="${i}" class="delHist">Suppr</button></div></div>`;
    histList.appendChild(row);
  });
  histList.querySelectorAll('.delHist').forEach(b=>b.onclick=()=>{ history.splice(Number(b.dataset.i),1); renderHist(); });
}

/* ===== brands chips ===== */
function buildBrands(){
  brandsArea.innerHTML='';
  BRANDS.forEach(b=>{
    const el = document.createElement('span');
    el.className='chip'+(selectedBrands.includes(b)?' on':'');
    el.textContent=b;
    el.onclick = ()=>{
      if(!isVIP){ el.animate([{opacity:1},{opacity:0.6},{opacity:1}],{duration:180}); return; }
      if(selectedBrands.includes(b)){ selectedBrands = selectedBrands.filter(x=>x!==b); el.classList.remove('on'); }
      else { selectedBrands.unshift(b); el.classList.add('on'); }
      render();
    };
    brandsArea.appendChild(el);
  });
}

/* ===== mini best ===== */
function showMini(){
  miniList.innerHTML='';
  if(bestArticles.length===0){ miniList.innerHTML='<div class="small">Aucun meilleur article</div>'; open(mini); return; }
  bestArticles.forEach((it,i)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML = `<img src="${it.image}" alt=""><div style="flex:1"><strong>${it.title}</strong><div class="small">${it.price}</div><div style="margin-top:6px"><button data-i="${i}" class="miniFav">Favoris</button></div></div>`;
    miniList.appendChild(div);
  });
  miniList.querySelectorAll('.miniFav').forEach(b=>b.onclick=()=>{ const it=bestArticles[Number(b.dataset.i)]; if(!favorites.find(f=>f.id===it.id)) favorites.unshift(it); renderFavList(); });
  open(mini);
}

/* ===== simulate feed + best ticks ===== */
function resetFeed(){
  if(feedTimer) clearInterval(feedTimer);
  const ms = (isVIP && opt0.checked) ? 6000 : 20000;
  feedTimer = setInterval(()=>{
    const b = BRANDS[Math.floor(Math.random()*BRANDS.length)];
    const it = {id:Date.now()+Math.floor(Math.random()*999), title:`${b} - Nouveau`, brand:b, size:['S','M','L'][Math.floor(Math.random()*3)], cond:'Tr√®s bon √©tat', price:`${Math.floor(Math.random()*80)+10}‚Ç¨`, link:'#', image:`https://images.unsplash.com/photo-1520975698519-53c8e7c1a7a6?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&s=${Math.floor(Math.random()*9999)}`};
    items.unshift(it);
    if(isVIP && optNotif.checked && Math.random()<0.3){ bestArticles.unshift(it); if(bestArticles.length>6) bestArticles.length=6; showMini(); }
    if(items.length>250) items.length=250;
    render();
  }, ms);
}

/* ===== VIP logic ===== */
function startVip(duration=60000){
  isVIP=true;
  vipExpires = Date.now() + duration;
  document.getElementById('settingsBtn').classList.add('vip');
  vipArea.classList.remove('hidden');
  optFavs.checked = true;
  favBtn.classList.toggle('hidden', !(isVIP && optFavs.checked));
  buildBrands();
  startVipTimer();
  resetFeed();
}
function stopVip(){
  isVIP=false;
  vipExpires=0;
  clearInterval(vipTimer); vipTimer=null;
  document.getElementById('settingsBtn').classList.remove('vip');
  vipArea.classList.add('hidden');
  favBtn.classList.add('hidden');
  selectedBrands = []; buildBrands();
  bestArticles = []; close(mini);
  resetFeed();
  alert('VIP expir√© (test)');
}
function startVipTimer(){
  if(vipTimer) clearInterval(vipTimer);
  vipTimer = setInterval(()=>{
    const remaining = vipExpires - Date.now();
    if(remaining <= 0){ stopVip(); return; }
    const s = Math.floor(remaining/1000); const m = Math.floor(s/60); const sec=s%60;
    document.getElementById('openVip').textContent = `VIP actif ${m}:${sec.toString().padStart(2,'0')}`;
  },500);
}

/* ===== events init ===== */
function init(){
  // theme
  darkToggle.onchange = ()=> document.documentElement.classList.toggle('dark', darkToggle.checked);

  // settings open/close
  settingsBtn.onclick = ()=> settingsPanel.style.display = settingsPanel.style.display==='block' ? 'none' : 'block';
  document.addEventListener('click', (e)=> { if(!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) settingsPanel.style.display='none'; });

  // VIP popup
  openVip.onclick = ()=> open(vipPopup);
  vipClose.onclick = ()=> close(vipPopup);
  cancelVip.onclick = ()=> close(vipPopup);
  payVip.onclick = ()=> { startVip(60000); close(vipPopup); };

  // brands popup
  openBrands.onclick = ()=> { if(!isVIP){ alert('VIP requis'); return; } buildBrands(); open(brandsPopup); };
  brandsClose.onclick = ()=> close(brandsPopup);
  closeBrandsBtn.onclick = ()=> close(brandsPopup);

  // favorites/history
  openFavsBtn.onclick = ()=> { renderFavList(); open(favPopup); };
  favClose.onclick = ()=> close(favPopup);
  clearFav.onclick = ()=> { if(confirm('Tout supprimer ?')){ favorites=[]; renderFavList(); }};

  openHistBtn.onclick = ()=> { renderHist(); open(histPopup); };
  histClose.onclick = ()=> close(histPopup);
  clearHist.onclick = ()=> { if(confirm('Tout supprimer ?')){ history=[]; renderHist(); }};

  closeMini.onclick = ()=> close(mini);

  // bottom actions
  skipBtn.onclick = ()=> doSkip();
  favBtn.onclick = ()=> addFav();
  viewBtn.onclick = ()=> { const it = items[idx]; if(it) window.open(it.link || '#','_blank'); };

  // toggles
  opt0.onchange = ()=> resetFeed();
  optNotif.onchange = ()=> { if(optNotif.checked && isVIP) { /* best tick handled in resetFeed */ } };

  // initial render + feed
  render();
  resetFeed();
}
init();
</script>
</body>
</html>
