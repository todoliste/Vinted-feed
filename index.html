<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Vinted Feed ‚Äî Demo (VIP simul√©)</title>
<style>
  :root{
    --bg: #f5f7fa;
    --card: #ffffff;
    --text: #111827;
    --muted: #6b7280;
    --accent: #2563eb;
    --gold: linear-gradient(90deg,#ffd70022,#ffd70044);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  .dark{--bg:#0b1220;--card:#0f1720;--text:#e6eef8;--muted:#9aa6bf}
  header{position:fixed;top:0;left:0;right:0;height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 14px;background:rgba(255,255,255,0.7);backdrop-filter:blur(6px);box-shadow:0 1px 8px rgba(2,6,23,0.06);z-index:60}
  .logo{display:flex;align-items:center;gap:10px;font-weight:700}
  .logo img{width:28px;height:28px;border-radius:6px}
  .controls{display:flex;gap:8px;align-items:center}
  .icon{background:var(--card);border:0;padding:8px;border-radius:10px;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;align-items:center;justify-content:center}
  .icon img{width:20px;height:20px;display:block}
  .icon.gold{box-shadow:0 0 18px rgba(255,215,0,0.35);background:linear-gradient(180deg,#fff3d6,#fffaf0)}
  main{padding-top:86px;display:flex;flex-direction:column;align-items:center;gap:12px;min-height:calc(100vh - 86px)}
  #cardArea{width:360px;max-width:92vw;height:520px;position:relative;display:flex;align-items:center;justify-content:center}
  .card{position:absolute;width:100%;height:100%;border-radius:14px;background:var(--card);box-shadow:0 18px 40px rgba(2,6,23,0.12);display:flex;flex-direction:column;align-items:center;padding:12px;transition:transform .45s ease,opacity .35s}
  .card img{width:86%;height:260px;object-fit:cover;border-radius:10px;background:#f7f7f7}
  .info{width:100%;padding:8px;text-align:left}
  .info h3{margin:6px 0 4px;font-size:1.05rem}
  .info p{margin:2px 0;color:var(--muted);font-size:0.9rem}
  .price{margin-top:8px;font-weight:800;color:var(--accent)}
  .controls-bottom{display:flex;gap:12px;justify-content:center;align-items:center}
  .btn{padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 10px 24px rgba(37,99,235,0.18)}
  .btn.ghost{background:#6b7280}
  /* panels */
  .panel{position:fixed;top:72px;right:12px;width:320px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 18px 40px rgba(2,6,23,0.12);z-index:70;display:none}
  .panel h4{margin:0 0 8px 0}
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .brand-btn{padding:6px 8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;cursor:pointer;font-size:0.9rem}
  .brand-btn.off{opacity:0.45}
  .small{font-size:0.86rem;color:var(--muted)}
  .history-item{padding:8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(90deg,#fff,#fbfbfb);font-size:0.9rem}
  /* overlay login */
  #overlay{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;z-index:90}
  .login{background:var(--card);padding:18px;border-radius:12px;width:320px;text-align:center;box-shadow:0 18px 40px rgba(2,6,23,0.3)}
  .login h2{margin:0 0 6px 0}
  .login p{margin:0 0 12px 0;color:var(--muted)}
  .toggle{display:flex;gap:8px;align-items:center;margin-top:8px}
  /* responsive mobile adjustments */
  @media (max-width:420px){
    header{padding:0 10px}
    .panel{right:10px;left:10px;width:auto}
    #cardArea{height:440px}
    .card img{height:220px}
  }
</style>
</head>
<body>
<header>
  <div class="logo">
    <img src="https://cdn-icons-png.flaticon.com/512/925/925123.png" alt="">
    Vinted Feed
  </div>
  <div class="controls">
    <button id="vipBtn" class="icon" title="VIP">üíé</button>
    <button id="paramsBtn" class="icon" title="Param√®tres">‚öôÔ∏è</button>
    <button id="discordIcon" class="icon" title="Connexion Discord">
      <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" alt="discord">
    </button>
  </div>
</header>

<!-- Overlay login simul√© -->
<div id="overlay" aria-hidden="false">
  <div class="login" role="dialog" aria-modal="true">
    <h2>Se connecter via Discord</h2>
    <p>Simulation ‚Äî clique sur "Se connecter" pour continuer</p>
    <div style="display:flex;gap:8px;justify-content:center">
      <button id="connectBtn" class="btn">Se connecter</button>
    </div>
  </div>
</div>

<!-- Param√®tres -->
<div id="paramsPanel" class="panel" aria-hidden="true">
  <h4>Param√®tres</h4>
  <div class="row" style="margin-bottom:8px">
    <label class="small"><input id="themeToggle" type="checkbox"> Mode sombre</label>
  </div>
  <div class="row" style="margin-bottom:8px">
    <label class="small"><input id="allBrands" type="checkbox" checked> Toutes marques</label>
  </div>
  <div class="row" style="margin-bottom:8px">
    <label class="small">Seuil gain min (‚Ç¨)</label>
    <input id="gainMin" type="number" value="20" style="width:90px;padding:6px;border-radius:8px;border:1px solid #ddd"/>
  </div>
  <div style="margin-top:8px">
    <div class="small">Marques (VIP seulement)</div>
    <div id="brandsBox" class="row" style="margin-top:8px"></div>
  </div>
</div>

<!-- VIP panel -->
<div id="vipPanel" class="panel" aria-hidden="true" style="width:360px">
  <h4>VIP (simul√©)</h4>
  <div class="row" style="align-items:center;margin-bottom:8px">
    <label class="small"><input id="vipPaid" type="checkbox"> Activer VIP (simul√©)</label>
    <div style="margin-left:auto" class="small">Aura or si VIP</div>
  </div>
  <div class="row" style="margin:6px 0">
    <label class="small"><input id="zeroDelay" type="checkbox"> 0 Delay (mode rapide)</label>
  </div>
  <div class="row" style="margin:6px 0">
    <label class="small"><input id="notifyToggle" type="checkbox"> Notifications pour bonnes affaires</label>
  </div>
  <div class="row" style="margin:6px 0">
    <label class="small"><input id="historyToggle" type="checkbox"> Enregistrer historique des skips</label>
  </div>
  <div style="margin-top:8px">
    <div class="small">Historique des skips (VIP)</div>
    <div id="historyBox" style="margin-top:8px;max-height:220px;overflow:auto"></div>
  </div>
</div>

<main>
  <div id="cardArea" aria-live="polite">
    <div id="emptyMsg" style="color:var(--muted);text-align:center">Connectez-vous pour d√©marrer le feed</div>
  </div>

  <div class="controls-bottom" style="margin-top:10px">
    <button id="skipBtn" class="btn ghost">‚è≠ Skip</button>
    <button id="visitBtn" class="btn">üõç Voir sur Vinted</button>
  </div>
</main>

<script>
/* ------------ STATE & DATA ------------- */
const BRAND_LIST = ["Nike","Adidas","Ralph Lauren","CP Company","Puma","Reebok","Under Armour","New Balance","Converse","Vans","The North Face","Columbia","Patagonia","Fila","Champion","Tommy Hilfiger","Lacoste","Jordan","Asics","Carhartt"];
let selectedBrands = new Set(BRAND_LIST); // default all
let allBrands = true;
let items = [];         // feed items
let history = [];       // skipped items (if history enabled and VIP)
let connected = false;
let vip = false;
let zeroDelay = false;
let notifyEnabled = false;
let historyEnabled = false;
let gainMin = 20;
const MAX_CARDS = 30;
let feedInterval = null;

/* ------------ UI refs ------------- */
const overlay = document.getElementById('overlay');
const connectBtn = document.getElementById('connectBtn');
const discordIcon = document.getElementById('discordIcon');
const paramsBtn = document.getElementById('paramsBtn');
const vipBtn = document.getElementById('vipBtn');
const paramsPanel = document.getElementById('paramsPanel');
const vipPanel = document.getElementById('vipPanel');
const brandsBox = document.getElementById('brandsBox');
const historyBox = document.getElementById('historyBox');
const cardArea = document.getElementById('cardArea');
const skipBtn = document.getElementById('skipBtn');
const visitBtn = document.getElementById('visitBtn');
const allBrandsEl = document.getElementById('allBrands');
const gainMinEl = document.getElementById('gainMin');
const themeToggle = document.getElementById('themeToggle');
const vipPaidEl = document.getElementById('vipPaid');
const zeroDelayEl = document.getElementById('zeroDelay');
const notifyToggle = document.getElementById('notifyToggle');
const historyToggle = document.getElementById('historyToggle');

/* ------------ UTILITIES ------------- */
function saveState(){
  localStorage.setItem('vf_connected', connected ? '1' : '0');
  localStorage.setItem('vf_vip', vip ? '1' : '0');
  localStorage.setItem('vf_history', JSON.stringify(history));
  localStorage.setItem('vf_dark', document.body.classList.contains('dark') ? '1' : '0');
}
function loadState(){
  connected = localStorage.getItem('vf_connected') === '1';
  vip = localStorage.getItem('vf_vip') === '1';
  const h = localStorage.getItem('vf_history');
  if(h) history = JSON.parse(h);
  if(localStorage.getItem('vf_dark') === '1') document.body.classList.add('dark');
}
function genItem(i){
  const brand = BRAND_LIST[Math.floor(Math.random()*BRAND_LIST.length)];
  const title = `${brand} Article ${Math.floor(Math.random()*9999)}`;
  const priceV = Math.floor(Math.random()*120)+5;
  const priceE = priceV + Math.floor(Math.random()*300)+10;
  const gain = priceE - priceV;
  const id = 'a-' + Date.now() + '-' + i;
  return {id, brand, title, priceV, priceE, gain, image:`https://via.placeholder.com/800x520?text=${encodeURIComponent(brand)}`, link:`https://vinted.example/${encodeURIComponent(title)}`};
}
function notify(message){
  if(!notifyEnabled) return;
  if("Notification" in window && Notification.permission === "granted"){
    new Notification("Vinted Feed", {body: message});
  }
}

/* ------------ UI INITIAL ------------- */
function buildBrandButtons(){
  brandsBox.innerHTML = '';
  BRAND_LIST.forEach(b=>{
    const btn = document.createElement('button');
    btn.className = 'brand-btn';
    btn.textContent = b;
    btn.onclick = ()=>{
      if(!vip){ // not VIP -> block toggle and hint
        btn.classList.add('off'); setTimeout(()=>btn.classList.remove('off'),180);
        return;
      }
      if(selectedBrands.has(b)){ selectedBrands.delete(b); btn.classList.add('off'); allBrands = false; allBrandsEl.checked = false; }
      else { selectedBrands.add(b); btn.classList.remove('off'); }
      renderStack();
    };
    brandsBox.appendChild(btn);
  });
}
buildBrandButtons();

/* ------------ CONNECT (SIMU) ------------- */
function openOverlay(){
  overlay.style.display = 'flex';
}
function closeOverlay(){ overlay.style.display = 'none'; }
connectBtn.addEventListener('click', ()=>{
  connected = true;
  closeOverlay();
  saveState();
  startFeed();
});

/* ------------ PANELS ------------- */
paramsBtn.addEventListener('click', (e)=>{
  paramsPanel.style.display = paramsPanel.style.display === 'flex' ? 'none' : 'flex';
  vipPanel.style.display = 'none';
});
vipBtn.addEventListener('click', (e)=>{
  vipPanel.style.display = vipPanel.style.display === 'flex' ? 'none' : 'flex';
  paramsPanel.style.display = 'none';
});
document.addEventListener('click', (e)=>{
  if(!paramsPanel.contains(e.target) && e.target !== paramsBtn) paramsPanel.style.display = 'none';
  if(!vipPanel.contains(e.target) && e.target !== vipBtn) vipPanel.style.display = 'none';
});

/* ------------ THEME ------------- */
themeToggle.addEventListener('change', ()=>{ document.body.classList.toggle('dark'); saveState(); });

/* ------------ VIP toggles ------------- */
vipPaidEl.addEventListener('change', (e)=>{
  vip = !!e.target.checked;
  // show aura gold on discord icon if VIP
  if(vip) discordIcon.classList.add('gold'); else discordIcon.classList.remove('gold');
  saveState();
});
zeroDelayEl.addEventListener('change', (e)=>{ zeroDelay = !!e.target.checked; resetFeedInterval(); });
notifyToggle.addEventListener('change', (e)=>{ notifyEnabled = !!e.target.checked; if(notifyEnabled && Notification.permission !== "granted") Notification.requestPermission(); });
historyToggle.addEventListener('change', (e)=>{ historyEnabled = !!e.target.checked; if(!historyEnabled){ /* keep history but don't push */ } });

/* ------------ FILTERS ------------- */
allBrandsEl.addEventListener('change', (e)=>{
  allBrands = !!e.target.checked;
  if(allBrands){ selectedBrands = new Set(BRAND_LIST); Array.from(brandsBox.children).forEach(b=>b.classList.remove('off')); }
  renderStack();
});
gainMinEl.addEventListener('change', (e)=>{ gainMin = parseInt(e.target.value) || 0; renderStack(); });

/* ------------ FEED LOGIC ------------- */
function getFiltered(){
  return items.filter(it => (allBrands || selectedBrands.has(it.brand)) && it.gain >= gainMin).slice(0, MAX_CARDS);
}
function renderStack(){
  cardArea.innerHTML = '';
  if(!connected){ cardArea.innerHTML = `<div style="color:var(--muted);text-align:center">Connectez-vous pour afficher le feed</div>`; return; }
  const filtered = getFiltered();
  if(filtered.length === 0){ cardArea.innerHTML = `<div style="color:var(--muted);text-align:center">Aucun article (ajuste filtres)</div>`; return; }

  // we render top two: top (index 0) visible center; second prepare off-right (1000px)
  for(let i = Math.min(filtered.length-1,1); i >= 0; i--){
    const art = filtered[i];
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.id = art.id;
    el.style.zIndex = 100 + (1 - i);
    if(i === 0){
      el.style.transform = 'translateX(0)';
      el.style.opacity = '1';
    } else {
      el.style.transform = 'translateX(1000px)';
      el.style.opacity = '0.98';
    }
    el.innerHTML = `
      <img src="${art.image}" alt="${art.title}">
      <div class="info">
        <h3>${art.title}</h3>
        <p class="small">Marque: ${art.brand}</p>
        <p class="small">Prix Vinted: ‚Ç¨${art.priceV} ¬∑ Est.revente: ‚Ç¨${art.priceE}</p>
        <div class="price">Gain estim√©: ‚Ç¨${art.gain}</div>
      </div>
    `;
    // allow swipe by drag on touch / mouse
    addDrag(el);
    cardArea.appendChild(el);
  }
  // set visit button
  const top = filtered[0];
  visitBtn.onclick = ()=> window.open(top.link, '_blank');
}

/* swipe actions */
function removeTopArticle(direction){
  const filtered = getFiltered();
  if(filtered.length === 0) return;
  const art = filtered[0];
  // animate top card
  const topEl = cardArea.querySelector('.card');
  if(!topEl) return;
  topEl.style.transition = 'transform .45s ease, opacity .3s';
  topEl.style.transform = `translateX(${direction * 1200}px) rotate(${direction * 8}deg)`;
  topEl.style.opacity = '0';
  // after animation remove the item from items (first occurrence)
  setTimeout(()=>{
    const idx = items.findIndex(it=>it.id === art.id);
    if(idx !== -1) items.splice(idx,1);
    if(historyEnabled && vip){ history.unshift(art); saveState(); renderHistory(); }
    renderStack();
  },450);
}
function swipeLeft(){ removeTopArticle(-1); }
function swipeRight(){ removeTopArticle(1); }

/* ------------ DRAG / TOUCH SUPPORT ------------- */
function addDrag(el){
  let startX = 0, currentX = 0, dragging=false;
  const handleStart = (clientX)=>{ startX = clientX; dragging=true; el.style.transition='none'; };
  const handleMove = (clientX)=>{ if(!dragging) return; currentX = clientX - startX; el.style.transform = `translateX(${currentX}px) rotate(${currentX/20}deg)`; };
  const handleEnd = ()=>{
    if(!dragging) return; dragging=false;
    if(Math.abs(currentX) > 120){
      const dir = currentX > 0 ? 1 : -1;
      el.style.transition='transform .35s ease, opacity .2s';
      el.style.transform = `translateX(${dir*1200}px) rotate(${dir*8}deg)`;
      el.style.opacity='0';
      setTimeout(()=>{ // remove same as swipe
        const id = el.dataset.id;
        const idx = items.findIndex(it=>it.id === id);
        if(idx !== -1) items.splice(idx,1);
        if(historyEnabled && vip){ const art = {id, title: el.querySelector('h3')?.innerText || 'item', brand:'', gain:0}; history.unshift(art); saveState(); renderHistory(); }
        renderStack();
      },350);
    } else {
      el.style.transition='transform .35s ease';
      el.style.transform='translateX(0)';
    }
    currentX = 0;
  };
  // mouse
  el.addEventListener('mousedown', e=> handleStart(e.clientX));
  window.addEventListener('mousemove', e=> handleMove(e.clientX));
  window.addEventListener('mouseup', handleEnd);
  // touch
  el.addEventListener('touchstart', e=> handleStart(e.touches[0].clientX));
  el.addEventListener('touchmove', e=> { handleMove(e.touches[0].clientX); e.preventDefault(); }, {passive:false});
  el.addEventListener('touchend', handleEnd);
}

/* ------------ HISTORY ------------- */
function renderHistory(){
  historyBox.innerHTML = '';
  if(history.length === 0) { historyBox.innerHTML = '<div class="small">Aucun skip pour l\'instant</div>'; return; }
  history.slice(0,50).forEach(h=>{
    const d = document.createElement('div');
    d.className = 'history-item';
    d.textContent = `${h.brand} ¬∑ ${h.title} ¬∑ gain ${h.gain}‚Ç¨`;
    historyBox.appendChild(d);
  });
}

/* ------------ FEED CONTROL ------------- */
function startFeed(){
  // seed some items
  for(let i=0;i<12;i++) items.push(genItem(i));
  renderStack();
  resetInterval();
}
function resetInterval(){
  if(feedInterval) clearInterval(feedInterval);
  const ms = (vip && zeroDelay) ? 5000 : 30000;
  feedInterval = setInterval(()=>{
    if(items.length < 150) {
      const newIt = genItem(Date.now()%1000);
      items.push(newIt);
      // auto notify for big gains if notify enabled
      if(notifyEnabled && newIt.gain >= Math.max(60, gainMin + 40)){
        notify(`${newIt.brand} ‚Äî gain ${newIt.gain}‚Ç¨`);
      }
    }
    renderStack();
  }, ms);
}

/* ------------ UI Buttons ------------- */
skipBtn.addEventListener('click', ()=> swipeLeft());
document.addEventListener('keydown', (e)=>{ if(e.key === 'ArrowLeft') swipeLeft(); if(e.key === 'ArrowRight') swipeRight(); });

/* ------------ INITIAL STATE ------------- */
function boot(){
  // load persisted
  loadState();
  // apply VIP aura
  if(vip) discordIcon.classList.add('gold'); else discordIcon.classList.remove('gold');
  // show overlay if not connected
  if(!connected) openOverlay(); else { overlay.style.display='none'; startFeed(); }
  buildBrandButtons(); renderHistory();
  // sync UI toggles based on state
  vipPaidEl.checked = vip;
  zeroDelayEl.checked = zeroDelay;
  notifyToggle.checked = notifyEnabled;
  historyToggle.checked = historyEnabled;
  allBrandsEl.checked = allBrands;
  gainMinEl.value = gainMin;
}

/* helper brand UI builder (reflect vip state) */
function buildBrandButtons(){
  // clear and rebuild to reflect VIP lock state
  brandsBox.innerHTML = '';
  BRAND_LIST.forEach(b=>{
    const btn = document.createElement('button');
    btn.className = 'brand-btn';
    btn.textContent = b;
    if(!selectedBrands.has(b)) btn.classList.add('off');
    if(!vip) btn.classList.add('off'); // non-VIP => visual disabled
    btn.onclick = ()=>{
      if(!vip){
        // brief feedback if non VIP
        btn.animate([{opacity:1},{opacity:0.6},{opacity:1}],{duration:220});
        return;
      }
      if(selectedBrands.has(b)){ selectedBrands.delete(b); btn.classList.add('off'); allBrands=false; allBrandsEl.checked=false; }
      else{ selectedBrands.add(b); btn.classList.remove('off'); }
      renderStack();
    };
    brandsBox.appendChild(btn);
  });
}

/* ------------ persist/load functions ------------- */
function saveState(){
  localStorage.setItem('vf_connected', connected ? '1' : '0');
  localStorage.setItem('vf_vip', vip ? '1' : '0');
  localStorage.setItem('vf_history', JSON.stringify(history));
  localStorage.setItem('vf_dark', document.body.classList.contains('dark') ? '1' : '0');
  // selected brands (as array)
  localStorage.setItem('vf_selectedBrands', JSON.stringify(Array.from(selectedBrands)));
  localStorage.setItem('vf_allBrands', allBrands ? '1' : '0');
  localStorage.setItem('vf_gainMin', gainMin);
  localStorage.setItem('vf_zeroDelay', zeroDelay ? '1' : '0');
  localStorage.setItem('vf_notify', notifyEnabled ? '1' : '0');
  localStorage.setItem('vf_historyEnabled', historyEnabled ? '1' : '0');
}
function loadState(){
  connected = localStorage.getItem('vf_connected') === '1';
  vip = localStorage.getItem('vf_vip') === '1';
  try{ history = JSON.parse(localStorage.getItem('vf_history')||'[]') }catch(e){ history = [] }
  if(localStorage.getItem('vf_dark') === '1') document.body.classList.add('dark');
  const sb = JSON.parse(localStorage.getItem('vf_selectedBrands') || 'null');
  if(Array.isArray(sb)) selectedBrands = new Set(sb);
  allBrands = localStorage.getItem('vf_allBrands') !== '0';
  gainMin = parseInt(localStorage.getItem('vf_gainMin')||'20') || 20;
  zeroDelay = localStorage.getItem('vf_zeroDelay') === '1';
  notifyEnabled = localStorage.getItem('vf_notify') === '1';
  historyEnabled = localStorage.getItem('vf_historyEnabled') === '1';
}

/* ------------ boot up ------------- */
loadState();
boot();
</script>
</body>
</html>
